import{a as w}from"./index.daetGfa_.js";const T=5,L=6,g=10;let p=(e,n,t,f)=>(e.events=e.events||{},e.events[t+g]||(e.events[t+g]=f(s=>{e.events[t].reduceRight((l,d)=>(d(l),l),{shared:{},...s})})),e.events[t]=e.events[t]||[],e.events[t].push(n),()=>{let s=e.events[t],l=s.indexOf(n);s.splice(l,1),s.length||(delete e.events[t],e.events[t+g](),delete e.events[t+g])}),M=1e3,y=(e,n)=>p(e,f=>{let s=n(f);s&&e.events[L].push(s)},T,f=>{let s=e.listen;e.listen=(...d)=>(!e.lc&&!e.active&&(e.active=!0,f()),s(...d));let l=e.off;return e.events[L]=[],e.off=()=>{l(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let d of e.events[L])d();e.events[L]=[]}},M)},()=>{e.listen=s,e.off=l}});const N=(e={})=>{let n=w(e);return n.setKey=function(t,f){let s=n.value;typeof f>"u"&&t in n.value?(n.value={...n.value},delete n.value[t],n.notify(s,t)):n.value[t]!==f&&(n.value={...n.value,[t]:f},n.notify(s,t))},n};let h=e=>e,o={},v={addEventListener(){},removeEventListener(){}};function U(){try{return typeof localStorage<"u"}catch{return!1}}U()&&(o=localStorage);let m={addEventListener(e,n,t){window.addEventListener("storage",n),window.addEventListener("pageshow",t)},removeEventListener(e,n,t){window.removeEventListener("storage",n),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(v=m);function R(e,n=void 0,t={}){let f=t.encode||h,s=t.decode||h,l=o[e],d=w(e in o?s(l):n),c=d.set;d.set=u=>{l=f(u),typeof l>"u"?delete o[e]:o[e]=l,c(u)};function E(u){u.key===e?u.newValue===null?c(n):c(s(u.newValue)):o[e]||c(n)}function a(){l!==o[e]&&d.set(e in o?s(o[e]):n)}return y(d,()=>{if(a(),t.listen!==!1)return v.addEventListener(e,E,a),()=>{v.removeEventListener(e,E,a)}}),d}function S(e,n={},t={}){let f=t.encode||h,s=t.decode||h,l=N(),d=l.setKey,c=(i,r)=>{typeof r>"u"?(t.listen!==!1&&v.perKey&&v.removeEventListener(e+i,a,u),delete o[e+i]):(t.listen!==!1&&v.perKey&&!(i in l.value)&&v.addEventListener(e+i,a,u),o[e+i]=f(r))};l.setKey=(i,r)=>{c(i,r),d(i,r)};let E=l.set;l.set=function(i){for(let r in i)c(r,i[r]);for(let r in l.value)r in i||c(r,void 0);E(i)};function a(i){i.key?i.key.startsWith(e)&&(i.newValue===null?d(i.key.slice(e.length),void 0):d(i.key.slice(e.length),s(i.newValue))):E({})}function u(){let i={...n};for(let r in o)r.startsWith(e)&&(i[r.slice(e.length)]=s(o[r]));for(let r in i)l.setKey(r,i[r])}return y(l,()=>{if(u(),t.listen!==!1)return v.addEventListener(e,a,u),()=>{v.removeEventListener(e,a,u);for(let i in l.value)v.removeEventListener(e+i,a,u)}}),l}export{R as a,S as p};
