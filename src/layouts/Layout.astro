---
import { ClientRouter } from "astro:transitions";
import SEO from "../components/SEO.astro";
import Header from "../components/Header.astro";
import MobileAppNav from "../components/react/MobileAppNav";
import Footer from "../components/react/Footer";
import CartDrawer from "../components/react/CartDrawer";
import SearchModal from "../components/react/SearchModal";
import AddToCartToast from "../components/react/AddToCartToast";
import FloatingSupport from "../components/react/FloatingSupport";

import "../styles/global.css";

interface Props {
    title: string;
    description: string;
    image?: string;
    hideFloatingSupport?: boolean;
}

const { title, description, image, hideFloatingSupport = false } = Astro.props;
---

<!doctype html>
<html lang="es" class="dark">
    <head>
        <SEO title={title} description={description} image={image} />
        <ClientRouter />
        <link rel="sitemap" href="/sitemap-index.xml" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Montserrat:wght@200..800&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
            rel="stylesheet"
        />

        <style is:global>
            :root {
                --color-primary: #d4af37; /* Metallic Gold */
                --color-bg-dark: #050505; /* Deep Onyx */
                --color-bg-light: #f8f7f6;
                --color-text-light: #fafaf5;
                --color-surface: #121212;
            }

            html {
                font-family: "Manrope", system-ui, sans-serif;
                background-color: var(--color-bg-dark);
                color: var(--color-text-light);
                scroll-behavior: smooth;
                overflow-x: hidden;
            }

            body {
                margin: 0;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                width: 100%;
                position: relative;
            }

            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
                font-family: "Playfair Display", serif;
            }

            /* Custom Scrollbar */
            ::-webkit-scrollbar {
                width: 6px;
            }
            ::-webkit-scrollbar-track {
                background: var(--color-bg-dark);
            }
            ::-webkit-scrollbar-thumb {
                background: #333;
                border-radius: 3px;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: var(--color-primary);
            }

            .material-symbols-outlined {
                font-variation-settings:
                    "FILL" 0,
                    "wght" 300,
                    "GRAD" 0,
                    "opsz" 24;
            }

            /* Focus visible: anillo claro para teclado y accesibilidad (no quita outline) */
            :focus {
                outline: none;
            }
            :focus-visible {
                outline: 2px solid var(--color-primary);
                outline-offset: 2px;
            }
            button:focus-visible,
            a:focus-visible,
            [tabindex="0"]:focus-visible {
                outline: 2px solid var(--color-primary);
                outline-offset: 2px;
            }
        </style>
    </head>
    <body>
        <!-- Skip link: salta al contenido (accesibilidad, teclado y lectores de pantalla) -->
        <a
            href="#main-content"
            class="skip-link fixed left-4 top-4 z-[100] -translate-y-24 rounded-md bg-[#d4af37] px-4 py-2 text-sm font-bold text-[#050505] shadow-lg transition-transform focus:translate-y-0 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-[#050505]"
        >
            Saltar al contenido
        </a>

        <CartDrawer client:load />
        <SearchModal client:load />
        <AddToCartToast client:load />
        <Header />

        <main id="main-content" class="flex-1 w-full max-w-7xl mx-auto p-4 md:px-0" tabindex="-1">
            <slot />
        </main>

        <Footer client:visible />
        <MobileAppNav client:load />
        {!hideFloatingSupport && <FloatingSupport client:load />}

        <script>
            document.addEventListener("astro:page-load", () => {
                const observerOptions = {
                    root: null,
                    rootMargin: "0px",
                    threshold: 0.1,
                };

                const observer = new IntersectionObserver(
                    (entries, observer) => {
                        entries.forEach((entry) => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add("is-visible");
                                observer.unobserve(entry.target);
                            }
                        });
                    },
                    observerOptions,
                );

                const animatedElements =
                    document.querySelectorAll(".animate-on-scroll");
                animatedElements.forEach((el) => observer.observe(el));
            });
        </script>
    </body>
</html>
